<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coze Studio æœåŠ¡ç¼–æ’</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          'Helvetica Neue', Arial, sans-serif;
        line-height: 1.6;
        color: #333;
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      header {
        background-color: #4caf50;
        color: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      h1 {
        margin: 0;
        font-size: 2rem;
      }
      .container {
        background-color: white;
        padding: 30px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      .form-group {
        margin-bottom: 20px;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }
      input[type='text'],
      input[type='url'],
      textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 1rem;
      }
      textarea {
        height: 150px;
        resize: vertical;
      }
      button {
        background-color: #4caf50;
        color: white;
        padding: 12px 20px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        margin-right: 10px;
      }
      button:hover {
        background-color: #45a049;
      }
      .result {
        margin-top: 20px;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 4px;
        border-left: 4px solid #4caf50;
      }
      .error {
        margin-top: 20px;
        padding: 20px;
        background-color: #ffebee;
        border-radius: 4px;
        border-left: 4px solid #f44336;
        color: #d32f2f;
      }
      .workflow-item {
        background-color: #f9f9f9;
        padding: 15px;
        border-radius: 4px;
        margin-bottom: 10px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .workflow-item:hover {
        background-color: #f0f0f0;
      }
      .workflow-item.selected {
        background-color: #e3f2fd;
        border-left: 4px solid #2196f3;
      }
      .api-key-input {
        position: relative;
      }
      .toggle-visibility {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        cursor: pointer;
        color: #666;
        padding: 0;
        margin: 0;
      }
      .section {
        margin-bottom: 30px;
        padding-bottom: 20px;
        border-bottom: 1px solid #eee;
      }
      .section:last-child {
        border-bottom: none;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Coze Studio æœåŠ¡ç¼–æ’</h1>
      <p>å¯è§†åŒ–ç¼–æ’å’Œæ‰§è¡ŒCoze Studioå·¥ä½œæµ</p>
    </header>

    <div class="container">
      <div class="section">
        <h2>é…ç½®</h2>
        <div class="form-group">
          <label for="apiKey">Coze Studio API Key</label>
          <div class="api-key-input">
            <input
              type="text"
              id="apiKey"
              placeholder="è¾“å…¥Coze Studio API Key"
              value=""
            />
            <button
              type="button"
              class="toggle-visibility"
              onclick="toggleApiKeyVisibility()"
            >
              <span id="visibilityIcon">ğŸ‘ï¸â€ğŸ—¨ï¸</span>
            </button>
          </div>
        </div>

        <div class="form-group">
          <label for="baseUrl">API Base URL</label>
          <input
            type="url"
            id="baseUrl"
            placeholder="Coze Studio APIåŸºç¡€URL"
            value="https://api.coze.com/v1"
          />
        </div>
      </div>

      <div class="section">
        <h2>å·¥ä½œæµç®¡ç†</h2>
        <button onclick="getWorkflows()">è·å–å¯ç”¨å·¥ä½œæµ</button>
        <div id="workflowsList" style="margin-top: 15px"></div>
      </div>

      <div class="section">
        <h2>æ‰§è¡Œå·¥ä½œæµ</h2>
        <div class="form-group">
          <label for="workflowId">å·¥ä½œæµID</label>
          <input type="text" id="workflowId" placeholder="è¾“å…¥å·¥ä½œæµID" />
        </div>

        <div class="form-group">
          <label for="taskInput">ä»»åŠ¡è¾“å…¥</label>
          <textarea
            id="taskInput"
            placeholder="è¾“å…¥è¦æ‰§è¡Œçš„ä»»åŠ¡æè¿°..."
          ></textarea>
        </div>

        <button onclick="executeWorkflow()">æ‰§è¡Œå·¥ä½œæµ</button>
        <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
      </div>

      <div id="result" style="margin-top: 20px"></div>
    </div>

    <script>
      let currentWorkflows = [];

      // åˆ‡æ¢API Keyå¯è§æ€§
      function toggleApiKeyVisibility() {
        const apiKeyInput = document.getElementById('apiKey');
        const visibilityIcon = document.getElementById('visibilityIcon');

        if (apiKeyInput.type === 'password') {
          apiKeyInput.type = 'text';
          visibilityIcon.textContent = 'ğŸ‘ï¸â€ğŸ—¨ï¸';
        } else {
          apiKeyInput.type = 'password';
          visibilityIcon.textContent = 'ğŸ™ˆ';
        }
      }

      // è·å–å¯ç”¨å·¥ä½œæµ
      async function getWorkflows() {
        const apiKey = document.getElementById('apiKey').value;
        const baseUrl = document.getElementById('baseUrl').value;

        if (!apiKey) {
          showError('è¯·å…ˆè¾“å…¥API Key');
          return;
        }

        try {
          const response = await fetch(`${baseUrl}/workflows`, {
            headers: {
              Authorization: `Bearer ${apiKey}`,
              'Content-Type': 'application/json',
            },
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          currentWorkflows = data.workflows || [];

          displayWorkflows(currentWorkflows);
        } catch (error) {
          showError(`è·å–å·¥ä½œæµå¤±è´¥: ${error.message}`);
        }
      }

      // æ˜¾ç¤ºå·¥ä½œæµåˆ—è¡¨
      function displayWorkflows(workflows) {
        const workflowsList = document.getElementById('workflowsList');
        workflowsList.innerHTML = '';

        if (workflows.length === 0) {
          workflowsList.innerHTML = '<p>æ²¡æœ‰å¯ç”¨çš„å·¥ä½œæµ</p>';
          return;
        }

        workflows.forEach((workflow) => {
          const workflowItem = document.createElement('div');
          workflowItem.className = 'workflow-item';
          workflowItem.innerHTML = `
                    <strong>${workflow.name}</strong><br>
                    <small>ID: ${workflow.id}</small><br>
                    <small>${workflow.description || 'æ— æè¿°'}</small>
                `;

          workflowItem.onclick = () => selectWorkflow(workflow);
          workflowsList.appendChild(workflowItem);
        });
      }

      // é€‰æ‹©å·¥ä½œæµ
      function selectWorkflow(workflow) {
        document.getElementById('workflowId').value = workflow.id;

        // æ›´æ–°é€‰ä¸­çŠ¶æ€
        document.querySelectorAll('.workflow-item').forEach((item) => {
          item.classList.remove('selected');
        });
        event.target.closest('.workflow-item').classList.add('selected');
      }

      // æ‰§è¡Œå·¥ä½œæµ
      async function executeWorkflow() {
        const apiKey = document.getElementById('apiKey').value;
        const baseUrl = document.getElementById('baseUrl').value;
        const workflowId = document.getElementById('workflowId').value;
        const taskInput = document.getElementById('taskInput').value;

        if (!apiKey) {
          showError('è¯·å…ˆè¾“å…¥API Key');
          return;
        }

        if (!workflowId) {
          showError('è¯·è¾“å…¥å·¥ä½œæµID');
          return;
        }

        if (!taskInput) {
          showError('è¯·è¾“å…¥ä»»åŠ¡æè¿°');
          return;
        }

        try {
          const response = await fetch(`${baseUrl}/workflows/run`, {
            method: 'POST',
            headers: {
              Authorization: `Bearer ${apiKey}`,
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              workflow_id: workflowId,
              inputs: {
                prompt: taskInput,
              },
              parameters: {
                temperature: 0.2,
                max_tokens: 1000,
              },
            }),
          });

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const data = await response.json();
          showResult(data);
        } catch (error) {
          showError(`æ‰§è¡Œå·¥ä½œæµå¤±è´¥: ${error.message}`);
        }
      }

      // æ˜¾ç¤ºç»“æœ
      function showResult(data) {
        const resultDiv = document.getElementById('result');
        resultDiv.className = 'result';
        resultDiv.innerHTML = `
                <h3>æ‰§è¡Œç»“æœ</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
      }

      // æ˜¾ç¤ºé”™è¯¯
      function showError(message) {
        const resultDiv = document.getElementById('result');
        resultDiv.className = 'error';
        resultDiv.innerHTML = `
                <h3>é”™è¯¯</h3>
                <p>${message}</p>
            `;
      }

      // æ¸…é™¤ç»“æœ
      function clearResults() {
        document.getElementById('result').innerHTML = '';
      }

      // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æœ¬åœ°å­˜å‚¨çš„é…ç½®
      window.onload = function () {
        const savedApiKey = localStorage.getItem('cozeApiKey');
        const savedBaseUrl = localStorage.getItem('cozeBaseUrl');

        if (savedApiKey) {
          document.getElementById('apiKey').value = savedApiKey;
        }

        if (savedBaseUrl) {
          document.getElementById('baseUrl').value = savedBaseUrl;
        }
      };

      // ä¿å­˜é…ç½®åˆ°æœ¬åœ°å­˜å‚¨
      document.addEventListener('input', function (e) {
        if (e.target.id === 'apiKey') {
          localStorage.setItem('cozeApiKey', e.target.value);
        } else if (e.target.id === 'baseUrl') {
          localStorage.setItem('cozeBaseUrl', e.target.value);
        }
      });
    </script>
  </body>
</html>
